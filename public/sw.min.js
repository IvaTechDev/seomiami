const CACHE_VERSION="v1",CACHE_NAME="seoservicesmiami-v1",PRECACHE_ASSETS=["/","/offline.html","/styles/global.css"];function isStaticAsset(pathname){return[".css",".js",".jpg",".jpeg",".png",".gif",".svg",".webp",".avif",".woff",".woff2",".ttf",".eot"].some((ext=>pathname.endsWith(ext)))}async function cacheFirst(request){const cache=await caches.open(CACHE_NAME),cached=await cache.match(request);if(cached)return cached;try{const response=await fetch(request);return response.ok&&cache.put(request,response.clone()),response}catch(error){if(console.error("[Service Worker] Fetch failed:",error),"navigate"===request.mode)return cache.match("/offline.html");throw error}}async function networkFirst(request){const cache=await caches.open(CACHE_NAME);try{const response=await fetch(request);return response.ok&&cache.put(request,response.clone()),response}catch(error){console.error("[Service Worker] Network request failed:",error);const cached=await cache.match(request);if(cached)return cached;throw error}}async function staleWhileRevalidate(request){const cache=await caches.open(CACHE_NAME),cached=await cache.match(request),fetchPromise=fetch(request).then((response=>(response.ok&&cache.put(request,response.clone()),response)));return cached||fetchPromise}self.addEventListener("install",(event=>{console.log("[Service Worker] Installing..."),event.waitUntil(caches.open(CACHE_NAME).then((cache=>(console.log("[Service Worker] Precaching assets"),cache.addAll(PRECACHE_ASSETS))))),self.skipWaiting()})),self.addEventListener("activate",(event=>(console.log("[Service Worker] Activating..."),event.waitUntil(caches.keys().then((cacheNames=>Promise.all(cacheNames.filter((cacheName=>cacheName!==CACHE_NAME)).map((cacheName=>(console.log("[Service Worker] Deleting old cache:",cacheName),caches.delete(cacheName)))))))),self.clients.claim()))),self.addEventListener("fetch",(event=>{const{request:request}=event,url=new URL(request.url);url.origin===location.origin&&"GET"===request.method&&(isStaticAsset(url.pathname)?event.respondWith(cacheFirst(request)):url.pathname.startsWith("/api/")?event.respondWith(networkFirst(request)):event.respondWith(staleWhileRevalidate(request)))})),self.addEventListener("message",(event=>{if(event.data&&"SKIP_WAITING"===event.data.type&&self.skipWaiting(),event.data&&"CACHE_URLS"===event.data.type){const urlsToCache=event.data.payload;caches.open(CACHE_NAME).then((cache=>{cache.addAll(urlsToCache)}))}}));